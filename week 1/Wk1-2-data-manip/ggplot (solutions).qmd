---
title: "Intro to data manipulation and visualisation (with starwars)"
format: html
editor: visual
---

The purpose of this material is to give you some examples of plotting with the tidyverse.

For these exercises we're going to use an inbuilt dataset `starwars`, which contains traits of characters appearing in the starwars films.

![](https://upload.wikimedia.org/wikipedia/commons/thumb/c/ce/Star_wars2.svg/450px-Star_wars2.svg.png)

# Setting up

## Packages

Load relevant package

```{r}
library(tidyverse)
```

## Loading data

We'll use two versions of the starwars data

```{r}
# Each character appears once
data <- starwars

# each character in each film appears once
data_films <- starwars %>% unnest(films)
```

# What plot?

Before making plots, you need to deicde what plot to make. Below we ask some questions. Your challenge is to come up with a suitable plot for each question.

For each question, work in small groups to determine What type of plot to make. What are the variables you'll use. Use a white board to mock it up.

The website <https://www.data-to-viz.com/> provides a nice interface to select suitable plots and even provides some example code.

[![](images/data-to-viz-choose.JPG)](https://www.data-to-viz.com/)

[![](images/data-to-viz.JPG){fig-align="center"}](https://www.data-to-viz.com/)

## Exercises

1.  What is the distribution of heights among characters in the starwars movies dataset?

2.  How many of each different species are there in the starwars movies dataset?

3.  What is the relationship between height and mass of characters in the starwars movies dataset?

4.  Do characters with different eye colour differ in their height?

5.  What is the frequency of different eye colours in the entire starwars collection?

6.  What is the distribution of character height in differnt films?

# Basic recipe for a ggplot

![](images/ggplot2.jpg)

Now try to make the plots your group discussed, using ggplot.

For each plot you'll need to think about

-   what variables you're using,
-   what `geom` you're using.

You may want to look at the ggplot cheatsheet in the folder `cheatsheets`

![](images/data-visualization-cheatsheet-thumbs.png)

## Exercises

1.  What is the distribution of heights among characters in the starwars movies dataset?

```{r}
data %>% 
  ggplot(aes(height)) + 
  geom_histogram()

data %>%
  ggplot( aes(x=height)) +
  geom_density(fill="#69b3a2", color="#e9ecef", alpha=0.8)
```

2.  How many of each different species are there in the starwars movies dataset?

```{r}
data %>% 
  ggplot(aes(species)) + 
  geom_bar() + 
  coord_flip()
```

3.  What is the relationship between height and mass of characters in the starwars movies dataset?

```{r}
data %>% 
  ggplot(aes(height, mass)) + 
  geom_point()
```

4.  Do characters with different eye colour differ in their height?

```{r}
data %>% 
  ggplot(aes(eye_color, height)) + 
  geom_boxplot()
```

5.  What is the frequency of different eye colours in the entire starwars collection?

```{r}
data %>%
  ggplot( aes(x=eye_color)) +
  geom_bar()
```

6.  What is the distribution of character height in different films?

```{r}
data_films %>% 
  ggplot(aes(films, height)) +
  geom_boxplot()
```

# Cool tricks with ggplot

Now that you've made some basic plots, you can try some of the new super powers ggplot gives you.

## Adding a line

ggplot allows you to add a line, e.g.

```{r}
data %>% 
  filter(mass<500) %>%
  ggplot(aes(height, mass)) + 
  geom_point() +
  geom_smooth(method="lm")
```

## Colouring points

You can easily add colour to plots

```{r}
data %>% 
  filter(mass<500) %>%
  ggplot(aes(height, mass, col=eye_color)) + 
  geom_point()
```

## Faceting

Faceting is a super powerful feature that enables you to repeat a plot for different groups of data.

Let's say we wanted you to plot the relationship between height vs mass for each film (excluding jaba the hut). You just add a facet on the end!

```{r}
data_films %>% 
  filter(mass < 500) %>%
  ggplot(aes(height, mass)) + 
  geom_point() +
  geom_smooth(method="lm") +
  facet_wrap(~films)
```

Now you try!

Can you make a panel of plots, with a histogram of heights foreach film?

```{r}
data_films %>% 
  ggplot(aes(height)) + 
  geom_histogram() +
  facet_wrap(~films)
```

## Decorating

ggplot2 includes heaps of options for modifying plots, you can

-   use themes
-   add labels
-   change text
-   flip the axes
-   customise text and fonts
-   etc...

Here's an example

```{r}

data_films %>% 
  ggplot(aes(films, height, col = films)) +
  geom_boxplot(show.legend = FALSE) +
  # add an xlabel
  labs(x= "Film ", y = "Height (cm)", title = "Heights of characters") +
  # change plot theme
  theme_classic() + 
  # flip the axes
  coord_flip()
```

Check out the cheatsheet for some commands. There's tons of help for this on the internet!
